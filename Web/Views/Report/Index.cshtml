@model Web.ViewModels.ReportFilterViewModel

@{
    ViewData["Title"] = "A/R Aging Summary Report";
    ViewData["Subtitle"] = "Unpaid balances for each customer, grouped by days past due.";
}

@section Toolbar {
    <ul class="nav justify-content-end">
        <li class="nav-item">
            <form id="exportReportForm" asp-controller="Report" asp-action="GetExportSettings" method="post">
                <input type="hidden" name="CompanyId" value="@Model.CompanyId" />
                <input type="hidden" name="Date" value="@Model.Date.ToString("yyyy-MM-dd")" />
                <input type="hidden" name="NumberOfPeriods" value="@Model.NumberOfPeriods" />
                <button type="submit"  class="btn btn-outline-secondary">Export</button>
            </form>
        </li>
    </ul>
}

<div class="row">
    <div class="col-lg-3 col-md-12">
        <form class="need-validation" id="filterReportForm" action="/api/report/aging" method="post">
            <fieldset>
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group">
                            <label asp-for="CompanyId"></label>
                            <select id="companyId" asp-for="CompanyId" asp-items="@ViewBag.Companies" class="form-control selectpicker"
                                    required
                                    data-live-search="true">
                            </select>
                            <span asp-validation-for="CompanyId" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Date"></label>
                            <div class="input-group">
                                <input id="date" type="date" asp-for="Date" class="form-control" required />
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="fa fa-calendar-alt"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="NumberOfPeriods"></label>
                            <input id="numberOfPeriods" asp-for="NumberOfPeriods" type="number" step="1" class="form-control" min="1" max="10" required />
                            <span asp-validation-for="NumberOfPeriods" class="form-text text-danger"></span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="" role="toolbar" aria-label="Toolbar with button groups">
                            <button class="btn btn-outline-secondary">Run report</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="col-lg-9 col-md-12">
        <div class="card">
            <div id="content" class="card-body"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(e => {

            //On Export Button click
            $exportBtn = $('#exportBtn').click(_ => {
                var companyId = $('#companyId').val();
                var options = {
                    'type': 'post',
                    'url': `/report/getexportsettings/` + companyId,
                    //'data': { id: $('#companyId').val() }
                };
                $.ajax(options).done((data, status, jqXHR) => {
                    
                });
            });

            // Generate report
            $filterReportForm = $('#filterReportForm').on('submit', e => {
                $filterReportForm.ajaxSubmit({}, (target, data, status) => {
                    status === 'success' ? $('#content').html(data) : $('#content').empty();

                    var data = target.serializeJSON();
                    $exportReportForm.find('input[name=CompanyId]').val(data.CompanyId);
                    $exportReportForm.find('input[name=Date]').val(data.Date);
                    $exportReportForm.find('input[name=NumberOfPeriods]').val(data.NumberOfPeriods);
                });
                e.preventDefault();
            });

            $exportReportForm = $('#exportReportForm').on('submit', e => {
                $exportReportForm.ajaxSubmit({}, (target, data, status) => {
                    $(data).dialog('Export data');
                    //status === 'success' ? $('#content').html(data) : $('#content').empty();
                });
                e.preventDefault();
            })
        });
    </script>
}