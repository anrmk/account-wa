/***** SYNC CUStoMER ACTIVITIES****/
SELECT *  FROM [accountWa].[dbo].[CustomerActivities]
--truncate table 	[accountWa].[dbo].[CustomerActivities]
select * from [accountWa].[dbo].[Invoices] where [Subtotal] = '9125.85'

/***** SYNC CUStOMER ACTIVITIES****/
INSERT INTO [accountWa].[dbo].[CustomerActivities] (
  [Customer_Id]	,
  [CreatedDate],
  [IsActive]
) SELECT [Id], CURRENT_TIMESTAMP, 'True' FROM [accountWa].[dbo].[Customers]

/***** AGING REPORT SELECT ****/
DECLARE @date_from DATETIME;
SET @date_from = '2019-10-31';
SELECT 
  CUS.[AccountNumber], CUS.[Name], 
  INV.[Customer_Id] AS CustomerId, INV.[Id], INV.[No], DATEDIFF(DAY, INV.[DueDate], @date_from ) AS DiffDate,     
  CAST(INV.[Subtotal] * (1+INV.[TaxRate]/100) as decimal(10,2)) AS [Amount], INV.[Date], INV.[DueDate],  
  PAY.[Id] AS PayId, PAY.[Amount] AS PayAmount, PAY.[Date] AS PayDate
FROM [accountWa].[dbo].[Invoices] AS INV
LEFT JOIN  [accountWa].[dbo].[Payments] AS PAY
ON PAY.[Invoice_Id] = INV.[Id] AND PAY.[Date] <= @date_from
LEFT JOIN [accountWa].[dbo].Customers as CUS
ON CUS.[Id] = INV.[Customer_Id]
LEFT JOIN [accountWa].[dbo].Companies as COM
ON COM.[Id] = INV.[Customer_Id]
WHERE INV.[Company_Id] = 2 AND INV.[DueDate] >= DATEADD(day, 30*5*-1,  @date_from) AND INV.[Date] <= @date_from
ORDER BY INV.[Date] DESC



/***** CREATE NEW PAYMENTS WITH DATA BETWEEN X and Y ****/
DECLARE @date_from DATETIME;
DECLARE @date_to DATETIME;
SET @date_from = '2019-12-1';
SET @date_to = '2019-12-31';

--INSERT INTO [accountWa].[dbo].[Payments] (
--  [CreatedDate],
--  [UpdatedDate],
--  [Date],
--  [Invoice_Id],
--  [Amount],
--  [Ref],
--  [IsDraft]	) 
SELECT 
	CURRENT_TIMESTAMP AS 'CreatedDate', 
	CURRENT_TIMESTAMP AS 'UpdatedDate',
	dateadd(day, rand(checksum(newid()))*(1+datediff(day, @date_from, @date_to)), @date_from) AS 'Date',
	INV.[Id] AS 'Invoice_Id',
	INV.[Subtotal] as 'Amount',
	CONCAT('D_', INV.Id) AS 'Ref',
	'True'
FROM [accountWa].[dbo].[Invoices] AS INV
LEFT JOIN [accountWa].[dbo].[Customers] AS CUS
ON CUS.[Id] = INV.[Customer_Id]
WHERE INV.[Date] < @date_from 
AND CUS.[Company_Id] = 2   --ORDER BY INV.[Id]
AND CUS.[AccountNumber] NOT IN ()
ORDER BY INV.[Id]

--SELECT INV.[No], INV.[Subtotal], INV.[Customer_Id], INV.[IsDraft], CUS.[Company_Id], CUS.[AccountNumber] 
--FROM [accountWa].[dbo].[Invoices] AS INV
--LEFT JOIN [accountWa].[dbo].[Customers] AS CUS
--ON CUS.[Id] = INV.[Customer_Id]
--WHERE INV.[Date] > '2019-10-30' AND  INV.[Date] < '2019-11-30' 
--AND CUS.[Company_Id] = 2

/***** INSERT CUSTOMERS ACTIVITIES ****/
--INSERT INTO [accountWa].[dbo].[CustomerActivities] (
  --[Customer_Id],
  --[CreatedDate],
  --[IsActive])
SELECT 
	[Id],
	[CreatedDate],
	'True'
FROM [accountWa].[dbo].[Customers] 
WHERE [Company_Id] = 2


/***** INSERT PAYMENTS BETWEE TWO DATES ****/
SELECT * FROM [accountWa].[dbo].[Payments] 

DECLARE @pdate_from DATETIME;
DECLARE @pdate_to DATETIME;
SET @pdate_from = '2019-11-1';
SET @pdate_to = '2019-11-30';
INSERT INTO [accountWa].[dbo].[Payments] (
	[Invoice_Id],
	[Ref],
	[Amount],
	[Date],
	[CreatedDate],
	[UpdatedDate],
	[IsDraft]
)
SELECT 
	[Id] AS 'Invoice_Id', 
	[No] AS 'Ref',
	[Subtotal] AS 'Amount',
	dateadd(day, rand(checksum(newid()))*(1+datediff(day, @pdate_from, @pdate_to)), @pdate_from) AS 'Date',
	CURRENT_TIMESTAMP,
	CURRENT_TIMESTAMP,
	'True' AS 'IsDraft'
FROM [accountWa].[dbo].[Invoices] WHERE [Date] <= @pdate_from AND
[Customer_Id] IN (
	SELECT [Id] FROM [accountWa].[dbo].[Customers]
	WHERE [AccountNumber] IN (
'168144',
'168145',
'168146',
'168147',
'168148',
'168149',
'168150',
'168153',
'168154',
'168155',
'168156',
'168157',
'168158',
'168159',
'168160',
'168165',
'168166',
'168167',
'168168',
'168169',
'168170',
'168175',
'168176',
'168177',
'168178',
'168184',
'168185',
'168186',
'168187',
'168188',
'168194',
'168195',
'168196',
'168199',
'168200',
'168201',
'168202',
'168203',
'168204',
'168215',
'168216',
'168217',
'168218',
'168219',
'168220',
'168221',
'168222',
'168232',
'168233',
'168237',
'168238',
'168239',
'168240',
'168241',
'168242',
'168243',
'168244',
'168245',
'168246',
'168247',
'168257',
'168258',
'168259',
'168260',
'168278',
'168279',
'168280',
'168281',
'168282',
'168283',
'168284',
'168285',
'168286',
'168287',
'168288',
'168289',
'168290',
'168291',
'168292',
'168293',
'168294',
'168295',
'168296',
'168297',
'168298',
'168299',
'168300',
'168301',
'168302',
'168303',
'168304',
'168305',
'168306',
'168307',
'168308',
'168314',
'168315',
'168316',
'168317',
'168318',
'168319',
'168320',
'168321',
'168322',
'168323',
'168324',
'168325',
'168326',
'168327',
'168328',
'168329',
'168330',
'168331',
'168332',
'168342',
'168343',
'168344',
'168345',
'168346',
'168347',
'168348',
'168349',
'168350',
'168351',
'168352',
'168353',
'168354',
'168355',
'168356',
'168357',
'168358',
'168359',
'168360',
'168363',
'168364',
'168365',
'168366',
'168367',
'168368',
'168369',
'168370',
'168371',
'168373',
'168374',
'168375',
'168376',
'168379',
'168380',
'168381',
'168382',
'168384',
'168385',
'168386',
'168387',
'168388',
'168389',
'168390',
'168391',
'168392',
'168393',
'168396',
'168397',
'168398',
'168399',
'168407',
'168408',
'168409',
'168410',
'168411',
'168413',
'168414',
'168415',
'168416',
'168417',
'168418',
'168419',
'168420',
'168421',
'168422',
'168423',
'168424',
'168425',
'168427',
'168428',
'168429',
'168431',
'168432',
'168433',
'168434',
'168435',
'168436',
'168437',
'168438',
'168439',
'168440',
'168441',
'168442',
'168443',
'168444',
'168445',
'168446',
'168447',
'168457',
'168458',
'168459',
'168466',
'168467',
'168468',
'168469',
'168470',
'168471',
'168472',
'168473',
'168474',
'168475',
'168476',
'168477',
'168487',
'168488',
'168489',
'168490',
'168491',
'168492',
'168493',
'168494',
'168495',
'168496',
'168497',
'168498',
'168499',
'168500',
'168507',
'168508',
'168509',
'168510',
'168511',
'168512',
'168513',
'168514',
'168524',
'168525',
'168527',
'168528',
'168529',
'168530',
'168531',
'168532',
'168533',
'168534',
'168535',
'168536',
'168537',
'168547',
'168548',
'168549',
'168550',
'168551',
'168552',
'168553',
'168554',
'168557',
'168566',
'168567',
'168568',
'168569',
'168570',
'168571',
'168572',
'168573',
'168574',
'168575',
'168576',
'168586',
'168587',
'168588',
'168589',
'168590',
'168591',
'168592',
'168593',
'168594',
'168595',
'168596',
'168597',
'168608',
'168609',
'168610',
'168611',
'168612',
'168613',
'168614',
'168618',
'168624',
'168626',
'168627',
'168628',
'168629',
'168630',
'168631',
'168632',
'168633',
'168639',
'168642',
'168643',
'168644',
'168645',
'168646',
'168647',
'168649',
'168650',
'168651',
'168652',
'168653',
'168654',
'168655',
'168656',
'168658',
'168659',
'168660',
'168661',
'168662',
'168663',
'168664',
'168665',
'168667',
'168668',
'168669',
'168675',
'168676',
'168677',
'168678',
'168679',
'168680',
'168681',
'168683',
'168684',
'168685',
'168686',
'168687',
'168688',
'168689',
'168690',
'168691',
'168692',
'168693',
'168694',
'168695',
'168696',
'168697',
'168698',
'168699',
'168700',
'168701',
'168702',
'168703',
'168704',
'168705',
'168706',
'168707',
'168708',
'168709',
'168710',
'168711',
'168712',
'168713',
'168714',
'168715',
'168716',
'168717',
'168718',
'168719',
'168720',
'168721',
'168722',
'168736',
'168737',
'168738',
'168739',
'168740',
'168741',
'168742',
'168743',
'168744',
'168745',
'168746',
'168747',
'168748',
'168749',
'168750',
'168751',
'168752',
'168753',
'168754',
'168755',
'168756',
'168757',
'168758',
'168759',
'168760',
'168761',
'168762',
'168763',
'168764',
'168769',
'168771',
'168772',
'168773',
'168774',
'168775',
'168776',
'168777',
'168778',
'168779',
'168780',
'168781',
'168782',
'168783',
'168784',
'168786',
'168787',
'168788',
'168789',
'168790',
'168791',
'168792',
'168793',
'168794',
'168795',
'168796',
'168797',
'168798',
'168799',
'168800',
'168809',
'168810',
'168811',
'168812',
'168813',
'168814',
'168815',
'168816',
'168817',
'168818',
'168819',
'168820',
'168821',
'168822',
'168823',
'168824',
'168825',
'168826',
'168827',
'168828',
'168829',
'168830',
'168831',
'168832',
'168833',
'168834',
'168835',
'168836',
'168837',
'168838',
'168839',
'168840',
'168841',
'168842',
'168843',
'168844',
'168845',
'168846',
'168851',
'168852',
'168853',
'168856',
'168857',
'168858',
'168859',
'168860',
'168861',
'168862',
'168863',
'168864',
'168865',
'168866',
'168867',
'168868',
'168869',
'168870',
'168871',
'168872',
'168873',
'168874',
'168875',
'168876',
'168877',
'168878',
'168879',
'168880',
'168881',
'168882',
'168883',
'168884',
'168885',
'168886',
'168887',
'168888',
'168889',
'168890',
'168891',
'168896',
'168897',
'168898',
'168899',
'168900',
'168901',
'168902',
'168903',
'168904',
'168905',
'168906',
'168907',
'168908',
'168909',
'168910',
'168911',
'168912',
'168913',
'168914',
'168915',
'168916',
'168917',
'168919',
'168920',
'168921',
'168922',
'168923',
'168924',
'168925',
'168926',
'168927',
'168928',
'168929',
'168930',
'168931',
'168932',
'168933',
'168934',
'168935',
'168936',
'168937',
'168938',
'168939',
'168940',
'168941',
'168942',
'168943',
'168944',
'168945',
'168946',
'168947',
'168948',
'168949',
'168950',
'168951',
'168952',
'168958',
'168959',
'168961',
'168962',
'168963',
'168964',
'168965',
'168966',
'168967',
'168968',
'168969',
'168970',
'168971',
'168972',
'168973',
'168974',
'168975',
'168976',
'168977',
'168978',
'168979',
'168980',
'168981',
'168982',
'168983',
'168984',
'168985',
'168986',
'168998',
'168999',
'169000',
'169001',
'169002',
'169003',
'169004',
'169005',
'169006',
'169007',
'169008',
'169009',
'169010',
'169011',
'169012',
'169013',
'169014',
'169015',
'169016',
'169017',
'169018',
'169019',
'169020',
'169021',
'169022',
'169023',
'169024',
'169025',
'169026',
'169027',
'169028',
'169029',
'169030',
'169042',
'169043',
'169044',
'169045',
'169046',
'169047',
'169048',
'169049',
'169050',
'169051',
'169052',
'169054',
'169055',
'169056',
'169057',
'169058',
'169059',
'169060',
'169061',
'169062',
'169063',
'169064',
'169065',
'169066',
'169067',
'169068',
'169075',
'169076',
'169077',
'169078',
'169079',
'169080',
'169081',
'169082',
'169083',
'169084',
'169085',
'169086',
'169087',
'169088',
'169089',
'169090',
'169091',
'169092',
'169093',
'169094',
'169095',
'169096',
'169097',
'169103',
'169105',
'169106',
'169107',
'169109',
'169110',
'169111',
'169112',
'169117',
'169118',
'169119',
'169120',
'169121',
'169122',
'169123',
'169124',
'169125',
'169126',
'169130',
'169131',
'169132',
'169133',
'169134',
'169136',
'169137',
'169138',
'169139',
'169140',
'169141',
'169142',
'169143',
'169144',
'169145',
'169146',
'169147',
'169148',
'169149',
'169150',
'169151',
'169152',
'169153',
'169154',
'169155',
'169161',
'169162',
'169163',
'169164',
'169165',
'169166',
'169167',
'169168',
'169169',
'169170',
'169171',
'169172',
'169173',
'169174',
'169175',
'169176',
'169177',
'169178',
'169179',
'169180',
'169181',
'169182',
'169183',
'169192',
'169193',
'169194',
'169195',
'169197',
'169198',
'169199',
'169200',
'169201',
'169202',
'169203',
'169204',
'169211',
'169212',
'169213',
'169215',
'169216',
'169217',
'169218',
'169219',
'169220',
'169221',
'169222',
'169223',
'169224',
'169227',
'169228',
'169229',
'169230',
'169231',
'169232',
'169233',
'169234',
'169235',
'169237',
'169238',
'169239',
'169242',
'169243',
'169252',
'169255',
'169256',
'169257',
'169258',
'169259',
'169260',
'169261',
'169262',
'169263',
'169264',
'169266',
'169267',
'169268',
'169270',
'169271',
'169272',
'169273',
'169274',
'169276',
'169278',
'169279',
'169280',
'169281',
'169282',
'169283',
'169284',
'169285',
'169288',
'169290',
'169291',
'169292',
'169293',
'169294',
'169295',
'169296',
'169298',
'169300',
'169301',
'169303',
'169304',
'169305',
'169306',
'169307',
'169308',
'169309',
'169315',
'169317',
'169318',
'169319',
'169320',
'169321',
'169322',
'169329',
'169330',
'169331',
'169332',
'169333',
'169344',
'169345',
'169346',
'169347',
'169348',
'169349',
'169350',
'169351',
'169352',
'169364',
'169365',
'169366',
'169367',
'169368',
'169369',
'169370',
'169384',
'169386',
'169387',
'169399',
'169400',
'169401',
'169402',
'169403',
'169404',
'169405',
'169406',
'169407',
'169408',
'169409',
'169410',
'169411',
'169412',
'169413',
'169414',
'169415',
'169416',
'169418',
'169419',
'169427',
'169428',
'169429',
'169431',
'169432',
'169433',
'169434',
'169435',
'169445',
'169446',
'169447',
'169448',
'169449',
'169450',
'169451',
'169452',
'169453',
'169462',
'169463',
'169464',
'169465',
'169466',
'169467',
'169468',
'169469',
'169470',
'169471',
'169472',
'169473',
'169474',
'169484',
'169485',
'169490',
'169491',
'169492',
'169493',
'169494',
'169495',
'169496',
'169497',
'169498',
'169499',
'169500',
'169506',
'169507',
'169508',
'169509',
'169510',
'169511',
'169512',
'169513',
'169514',
'169515',
'169516',
'169528',
'169529',
'169530',
'169531',
'169532',
'169533',
'169534',
'169535',
'169536',
'169537',
'169538',
'169539',
'169540',
'169541',
'169542',
'169543',
'169544',
'169545',
'169546',
'169547',
'169548',
'169549',
'169550',
'169566',
'169567',
'169568',
'169569',
'169571',
'169572',
'169573',
'169574',
'169575',
'169576',
'169577',
'169578',
'169579',
'169582',
'169583',
'169592',
'169593',
'169595',
'169596',
'169597',
'169598',
'169599',
'169600',
'169601',
'169602',
'169603',
'169604',
'169605',
'169606',
'169612',
'169614',
'169615',
'169616',
'169620',
'169622',
'169623',
'169624',
'169625',
'169626',
'169627',
'169628',
'169629',
'169630',
'169631',
'169632',
'169633',
'169634',
'169635',
'169639',
'169641',
'169642',
'169643',
'169644',
'169645',
'169648',
'169649',
'169652',
'169655',
'169656',
'169657',
'169658',
'169659',
'169669',
'169670',
'169679',
'169680',
'169681',
'169682',
'169683',
'169684',
'169685',
'169692',
'169693',
'169694',
'169695',
'169696',
'169710',
'169714',
'169723',
'169724',
'169727',
'169732',
'169739',
'169740',
'169742',
'169744',
'169745',
'169751',
'169752',
'169753',
'169754',
'169755',
'169756',
'169757',
'169758',
'169759',
'169760',
'169761',
'169762',
'169763',
'169764',
'169765',
'169766',
'169767',
'169768',
'169769',
'169770',
'169771',
'169772',
'169773',
'169774',
'169775',
'169776',
'169777',
'169778',
'169779',
'169780')
)